import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useMemo } from 'react';
import { Wallet, TrendingUp, TrendingDown, Plus, Minus, CreditCard, Banknote, ArrowRightLeft, ShieldAlert, Calendar } from 'lucide-react';
import { useApp } from '../App';
// Runtime-константы
import { PaymentMethod, TransactionType } from '../services/types';
const CashierPage = () => {
    const { sales, cash, setCash } = useApp();
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [modalType, setModalType] = useState(TransactionType.IN);
    const [transaction, setTransaction] = useState({ amount: '', reason: '' });
    const today = new Date().toISOString().split('T')[0];
    const formatPrice = (price) => {
        return price.toLocaleString('ru-RU');
    };
    const stats = useMemo(() => {
        const todaySales = sales.filter(s => s.date.startsWith(today));
        return {
            cash: todaySales.filter(s => s.paymentMethod === PaymentMethod.CASH).reduce((sum, s) => sum + s.total, 0),
            card: todaySales.filter(s => s.paymentMethod === PaymentMethod.CARD).reduce((sum, s) => sum + s.total, 0),
            transfer: todaySales.filter(s => s.paymentMethod === PaymentMethod.TRANSFER).reduce((sum, s) => sum + s.total, 0),
            debt: todaySales.filter(s => s.paymentMethod === PaymentMethod.DEBT).reduce((sum, s) => sum + s.total, 0),
            total: todaySales.reduce((sum, s) => sum + s.total, 0),
            count: todaySales.length
        };
    }, [sales, today]);
    const cashFlow = useMemo(() => {
        const todayCash = cash.filter(c => c.date.startsWith(today));
        return {
            in: todayCash.filter(c => c.type === TransactionType.IN).reduce((sum, c) => sum + c.amount, 0),
            out: todayCash.filter(c => c.type === TransactionType.OUT).reduce((sum, c) => sum + c.amount, 0)
        };
    }, [cash, today]);
    const handleTransaction = (e) => {
        e.preventDefault();
        if (!transaction.amount || !transaction.reason)
            return;
        const newTx = {
            id: Math.random().toString(36).substr(2, 9),
            date: new Date().toISOString(),
            amount: parseFloat(transaction.amount),
            type: modalType,
            reason: transaction.reason
        };
        setCash(prev => [newTx, ...prev]);
        setTransaction({ amount: '', reason: '' });
        setIsModalOpen(false);
    };
    const statCards = [
        { label: 'Наличные', value: stats.cash, icon: Banknote, color: 'text-emerald-600', bg: 'bg-emerald-50' },
        { label: 'Терминал', value: stats.card, icon: CreditCard, color: 'text-blue-600', bg: 'bg-blue-50' },
        { label: 'Переводы', value: stats.transfer, icon: ArrowRightLeft, color: 'text-violet-600', bg: 'bg-violet-50' },
        { label: 'Продажи в долг', value: stats.debt, icon: ShieldAlert, color: 'text-rose-600', bg: 'bg-rose-50' },
    ];
    return (_jsxs("div", { className: "space-y-8", children: [_jsxs("div", { className: "flex flex-col md:flex-row md:items-center justify-between gap-4", children: [_jsxs("div", { children: [_jsx("h2", { className: "text-2xl font-bold text-slate-800", children: "\u041A\u0430\u0441\u0441\u043E\u0432\u044B\u0439 \u043E\u0442\u0447\u0435\u0442" }), _jsx("p", { className: "text-slate-500 text-sm", children: "\u041C\u043E\u043D\u0438\u0442\u043E\u0440\u0438\u043D\u0433 \u0432\u044B\u0440\u0443\u0447\u043A\u0438 \u0438 \u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0440\u0430\u0441\u0445\u043E\u0434\u0430\u043C\u0438." })] }), _jsxs("div", { className: "flex items-center gap-2 bg-white px-4 py-2 rounded-xl border border-slate-200 text-slate-600 font-semibold shadow-sm text-sm", children: [_jsx(Calendar, { size: 18 }), _jsx("span", { children: new Date().toLocaleDateString('ru-RU', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) })] })] }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6", children: statCards.map((card, idx) => (_jsxs("div", { className: "bg-white p-6 rounded-3xl border border-slate-200 shadow-sm", children: [_jsx("div", { className: `w-12 h-12 ${card.bg} rounded-2xl flex items-center justify-center ${card.color} mb-4`, children: _jsx(card.icon, { size: 24 }) }), _jsx("p", { className: "text-xs font-black uppercase text-slate-400 tracking-wider mb-1", children: card.label }), _jsxs("h3", { className: "text-xl font-black text-slate-900", children: [formatPrice(card.value), " \u0441\u0443\u043C"] })] }, idx))) }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-8", children: [_jsxs("div", { className: "lg:col-span-2 space-y-6", children: [_jsxs("div", { className: "bg-slate-900 text-white p-8 rounded-[2.5rem] relative overflow-hidden shadow-2xl", children: [_jsx("div", { className: "absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -mr-20 -mt-20 blur-3xl" }), _jsxs("div", { className: "relative z-10 grid grid-cols-1 sm:grid-cols-2 gap-8", children: [_jsxs("div", { children: [_jsx("p", { className: "text-slate-400 text-sm font-semibold uppercase tracking-widest mb-2", children: "\u0412\u0441\u0435\u0433\u043E \u043F\u0440\u043E\u0434\u0430\u0436 \u0437\u0430 \u0434\u0435\u043D\u044C" }), _jsxs("h3", { className: "text-4xl font-black", children: [formatPrice(stats.total), " \u0441\u0443\u043C"] }), _jsxs("p", { className: "text-indigo-400 text-sm mt-4 font-bold", children: [stats.count, " \u0443\u0441\u043F\u0435\u0448\u043D\u044B\u0445 \u0442\u0440\u0430\u043D\u0437\u0430\u043A\u0446\u0438\u0439 \u0441\u0435\u0433\u043E\u0434\u043D\u044F"] })] }), _jsxs("div", { className: "flex flex-col justify-center space-y-4", children: [_jsxs("div", { className: "flex items-center justify-between p-4 bg-white/5 rounded-2xl", children: [_jsxs("span", { className: "flex items-center gap-2 text-emerald-400 font-bold", children: [_jsx(TrendingUp, { size: 16 }), " \u041F\u0440\u0438\u0445\u043E\u0434"] }), _jsxs("span", { className: "text-xl font-bold", children: ["+", formatPrice(stats.total - stats.debt + cashFlow.in), " \u0441\u0443\u043C"] })] }), _jsxs("div", { className: "flex items-center justify-between p-4 bg-white/5 rounded-2xl", children: [_jsxs("span", { className: "flex items-center gap-2 text-rose-400 font-bold", children: [_jsx(TrendingDown, { size: 16 }), " \u0420\u0430\u0441\u0445\u043E\u0434"] }), _jsxs("span", { className: "text-xl font-bold", children: ["-", formatPrice(cashFlow.out), " \u0441\u0443\u043C"] })] })] })] })] }), _jsxs("div", { className: "bg-white rounded-3xl border border-slate-200 overflow-hidden shadow-sm", children: [_jsxs("div", { className: "p-6 border-b border-slate-100 flex items-center justify-between", children: [_jsx("h4", { className: "font-bold text-slate-800", children: "\u0414\u0432\u0438\u0436\u0435\u043D\u0438\u0435 \u0434\u0435\u043D\u0435\u0436\u043D\u044B\u0445 \u0441\u0440\u0435\u0434\u0441\u0442\u0432" }), _jsxs("div", { className: "flex gap-2", children: [_jsxs("button", { onClick: () => { setModalType(TransactionType.IN); setIsModalOpen(true); }, className: "flex items-center gap-2 bg-emerald-50 text-emerald-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-emerald-100 transition-colors shadow-sm", children: [_jsx(Plus, { size: 16 }), " \u041F\u0440\u0438\u0445\u043E\u0434"] }), _jsxs("button", { onClick: () => { setModalType(TransactionType.OUT); setIsModalOpen(true); }, className: "flex items-center gap-2 bg-rose-50 text-rose-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-rose-100 transition-colors shadow-sm", children: [_jsx(Minus, { size: 16 }), " \u0420\u0430\u0441\u0445\u043E\u0434"] })] })] }), _jsx("div", { className: "divide-y divide-slate-50", children: cash.length === 0 ? (_jsx("div", { className: "p-12 text-center text-slate-400 italic font-medium", children: "\u0414\u0432\u0438\u0436\u0435\u043D\u0438\u0439 \u0437\u0430 \u0441\u0435\u0433\u043E\u0434\u043D\u044F \u043D\u0435\u0442." })) : (cash.map(tx => (_jsxs("div", { className: "p-4 flex items-center justify-between hover:bg-slate-50 transition-colors", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("div", { className: `w-10 h-10 rounded-xl flex items-center justify-center ${tx.type === TransactionType.IN ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'}`, children: tx.type === TransactionType.IN ? _jsx(TrendingUp, { size: 18 }) : _jsx(TrendingDown, { size: 18 }) }), _jsxs("div", { children: [_jsx("p", { className: "font-semibold text-slate-800", children: tx.reason }), _jsx("p", { className: "text-xs text-slate-400", children: new Date(tx.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) })] })] }), _jsxs("span", { className: `font-bold ${tx.type === TransactionType.IN ? 'text-emerald-600' : 'text-rose-600'}`, children: [tx.type === TransactionType.IN ? '+' : '-', formatPrice(tx.amount), " \u0441\u0443\u043C"] })] }, tx.id)))) })] })] }), _jsx("div", { className: "space-y-6", children: _jsxs("div", { className: "bg-indigo-600 rounded-[2rem] p-8 text-white relative overflow-hidden shadow-xl", children: [_jsx("div", { className: "absolute top-0 right-0 p-4 opacity-20", children: _jsx(Wallet, { size: 120 }) }), _jsx("h4", { className: "text-xl font-bold mb-4", children: "\u041D\u0430\u043B\u0438\u0447\u043D\u043E\u0441\u0442\u044C" }), _jsx("p", { className: "text-indigo-100 text-sm mb-6 leading-relaxed", children: "\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0444\u0430\u043A\u0442\u0438\u0447\u0435\u0441\u043A\u043E\u0435 \u043D\u0430\u043B\u0438\u0447\u0438\u0435 \u0434\u0435\u043D\u0435\u0433 \u0432 \u043A\u0430\u0441\u0441\u0435 (\u043D\u0430\u043B\u0438\u0447\u043D\u044B\u0435 + \u043F\u0440\u0438\u0445\u043E\u0434\u044B - \u0440\u0430\u0441\u0445\u043E\u0434\u044B)." }), _jsxs("div", { className: "space-y-2", children: [_jsx("p", { className: "text-xs uppercase font-bold text-indigo-300 tracking-widest", children: "\u0412 \u043A\u0430\u0441\u0441\u0435 (\u043D\u0430\u043B)" }), _jsxs("p", { className: "text-2xl font-black", children: [formatPrice(stats.cash + cashFlow.in - cashFlow.out), " \u0441\u0443\u043C"] })] })] }) })] }), isModalOpen && (_jsx("div", { className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm", children: _jsxs("div", { className: "bg-white rounded-3xl w-full max-w-md p-8 shadow-2xl", children: [_jsx("h3", { className: "text-2xl font-bold text-slate-800 mb-6", children: modalType === TransactionType.IN ? 'Записать приход' : 'Записать расход' }), _jsxs("form", { onSubmit: handleTransaction, className: "space-y-4", children: [_jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-bold text-slate-500 uppercase px-1", children: "\u0421\u0443\u043C\u043C\u0430 (\u0441\u0443\u043C)" }), _jsx("input", { required: true, type: "number", placeholder: "0", value: transaction.amount, onChange: (e) => setTransaction({ ...transaction, amount: e.target.value }), className: "w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:outline-none text-slate-900 font-bold text-lg" })] }), _jsxs("div", { className: "space-y-1", children: [_jsx("label", { className: "text-xs font-bold text-slate-500 uppercase px-1", children: "\u041F\u0440\u0438\u0447\u0438\u043D\u0430 / \u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435" }), _jsx("input", { required: true, type: "text", placeholder: "\u041D\u0430\u043F\u0440. \u041E\u043F\u043B\u0430\u0442\u0430 \u0437\u0430 \u0441\u0432\u0435\u0442, \u0418\u043D\u043A\u0430\u0441\u0441\u0430\u0446\u0438\u044F", value: transaction.reason, onChange: (e) => setTransaction({ ...transaction, reason: e.target.value }), className: "w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:outline-none text-slate-900" })] }), _jsxs("div", { className: "flex gap-3 pt-4", children: [_jsx("button", { type: "button", onClick: () => setIsModalOpen(false), className: "flex-1 px-6 py-3 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors", children: "\u041E\u0442\u043C\u0435\u043D\u0430" }), _jsx("button", { type: "submit", className: `flex-1 px-6 py-3 rounded-xl text-white font-black shadow-lg transition-all ${modalType === TransactionType.IN ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-rose-600 hover:bg-rose-700'}`, children: "\u041F\u041E\u0414\u0422\u0412\u0415\u0420\u0414\u0418\u0422\u042C" })] })] })] }) }))] }));
};
export default CashierPage;
